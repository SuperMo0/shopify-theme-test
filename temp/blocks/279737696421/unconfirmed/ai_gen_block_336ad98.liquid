{% doc %}
  @prompt
    Create a smooth scrolling text marquee banner that continuously scrolls text from right to left. The section should include settings to customize the marquee text, scrolling speed, text size, text color, and background color. The animation should be seamless with the text repeating continuously without gaps.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-marquee-banner-{{ ai_gen_id }} {
    display: block;
    width: 100%;
    background-color: {{ block.settings.background_color }};
    overflow: hidden;
    position: relative;
    padding: {{ block.settings.vertical_padding }}px 0;
  }

  .ai-marquee-banner__track-{{ ai_gen_id }} {
    display: flex;
    width: fit-content;
    animation: ai-marquee-scroll-{{ ai_gen_id }} {{ block.settings.scroll_speed }}s linear infinite;
  }

  .ai-marquee-banner__content-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    white-space: nowrap;
    padding-right: {{ block.settings.text_spacing }}px;
  }

  .ai-marquee-banner__text-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.text_size }}px;
    font-weight: {{ block.settings.text_weight }};
    text-transform: {{ block.settings.text_transform }};
    letter-spacing: {{ block.settings.letter_spacing }}px;
  }

  .ai-marquee-banner__separator-{{ ai_gen_id }} {
    display: inline-block;
    margin: 0 {{ block.settings.separator_spacing }}px;
    color: {{ block.settings.separator_color }};
    font-size: {{ block.settings.text_size }}px;
  }

  @keyframes ai-marquee-scroll-{{ ai_gen_id }} {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  .ai-marquee-banner-{{ ai_gen_id }}:hover .ai-marquee-banner__track-{{ ai_gen_id }} {
    animation-play-state: {{ block.settings.pause_on_hover }};
  }

  @media screen and (max-width: 749px) {
    .ai-marquee-banner__text-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.text_size }}px * 0.8);
    }

    .ai-marquee-banner__separator-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.text_size }}px * 0.8);
    }
  }
{% endstyle %}

<marquee-banner-{{ ai_gen_id }} class="ai-marquee-banner-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-marquee-banner__track-{{ ai_gen_id }}">
    {% for i in (1..2) %}
      <div class="ai-marquee-banner__content-{{ ai_gen_id }}">
        {% assign items = block.settings.marquee_text | split: '|' %}
        {% for item in items %}
          <span class="ai-marquee-banner__text-{{ ai_gen_id }}">{{ item | strip }}</span>
          {% unless forloop.last %}
            <span class="ai-marquee-banner__separator-{{ ai_gen_id }}">{{ block.settings.separator }}</span>
          {% endunless %}
        {% endfor %}
        {% if items.size > 0 %}
          <span class="ai-marquee-banner__separator-{{ ai_gen_id }}">{{ block.settings.separator }}</span>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</marquee-banner-{{ ai_gen_id }}>

<script>
  (function() {
    class MarqueeBanner{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.track = this.querySelector('.ai-marquee-banner__track-{{ ai_gen_id }}');
        this.content = this.querySelector('.ai-marquee-banner__content-{{ ai_gen_id }}');
        
        if (this.track && this.content) {
          this.adjustAnimation();
        }
      }

      adjustAnimation() {
        const contentWidth = this.content.offsetWidth;
        this.track.style.width = `${contentWidth * 2}px`;
      }
    }

    customElements.define('marquee-banner-{{ ai_gen_id }}', MarqueeBanner{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Scrolling marquee banner",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "textarea",
      "id": "marquee_text",
      "label": "Marquee text",
      "default": "Free Shipping on Orders Over $50 | New Arrivals Daily | Shop Now and Save 20%",
      "info": "Separate multiple text items with the | character"
    },
    {
      "type": "text",
      "id": "separator",
      "label": "Separator",
      "default": "â˜…"
    },
    {
      "type": "header",
      "content": "Animation"
    },
    {
      "type": "range",
      "id": "scroll_speed",
      "label": "Scroll speed",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "s",
      "default": 30,
      "info": "Lower values = faster scrolling"
    },
    {
      "type": "select",
      "id": "pause_on_hover",
      "label": "Pause on hover",
      "options": [
        {
          "value": "paused",
          "label": "Yes"
        },
        {
          "value": "running",
          "label": "No"
        }
      ],
      "default": "paused"
    },
    {
      "type": "header",
      "content": "Text style"
    },
    {
      "type": "range",
      "id": "text_size",
      "label": "Text size",
      "min": 12,
      "max": 48,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "select",
      "id": "text_weight",
      "label": "Text weight",
      "options": [
        {
          "value": "300",
          "label": "Light"
        },
        {
          "value": "400",
          "label": "Normal"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semi-bold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ],
      "default": "500"
    },
    {
      "type": "select",
      "id": "text_transform",
      "label": "Text transform",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "uppercase",
          "label": "Uppercase"
        },
        {
          "value": "lowercase",
          "label": "Lowercase"
        },
        {
          "value": "capitalize",
          "label": "Capitalize"
        }
      ],
      "default": "uppercase"
    },
    {
      "type": "range",
      "id": "letter_spacing",
      "label": "Letter spacing",
      "min": 0,
      "max": 5,
      "step": 0.5,
      "unit": "px",
      "default": 1
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "text_spacing",
      "label": "Text spacing",
      "min": 20,
      "max": 100,
      "step": 10,
      "unit": "px",
      "default": 40,
      "info": "Space between repeated text"
    },
    {
      "type": "range",
      "id": "separator_spacing",
      "label": "Separator spacing",
      "min": 10,
      "max": 60,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "range",
      "id": "vertical_padding",
      "label": "Vertical padding",
      "min": 5,
      "max": 50,
      "step": 5,
      "unit": "px",
      "default": 15
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "separator_color",
      "label": "Separator",
      "default": "#FFFFFF"
    }
  ],
  "presets": [
    {
      "name": "Scrolling marquee banner"
    }
  ]
}
{% endschema %}
